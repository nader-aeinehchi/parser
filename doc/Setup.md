# Setup the environment
Firstly, let us see how the environment should be set up.

We are using SBT as the build system.  Follow these steps:

1. Create the folder `project`
2. Create the file `project/build.properties` with the following content:
```
sbt.version=1.10.7
```

3. Download `antlr-4.13.2-complete` to `lib/antlr-4.13.2-complete` directly from ANTLR's homepage

4. Make sure that you include `project/Antlr4Gen.scala`.  This file works like a SBT plugin (see below).
When everything is setup, this file adds functionality to SBT. You would be able to run in SBT:

```
sbt
```
and then
```
antlr4GenerateAll
```

We will learn more this later on.

5. Create a `build.sbt` file like below:

```
lazy val root = (project in file("."))
  .settings(
    inThisBuild(
      List(
        organization := "org.naderica",
        scalaVersion := "3.6.3"
      )
    ),
    name := "parser",
    resolvers ++= Seq(
      Resolver.mavenLocal,
      "Maven Central" at "https://repo1.maven.org/maven2/"
    ),
    libraryDependencies ++= {
      val junitV = "4.13.2"
      val junitInterfaceV = "0.11"
      Seq(
        "org.scalameta" %% "scalameta" % "4.13.7",
        "com.typesafe.play" %% "play-json" % "2.10.1",
        "junit" % "junit" % junitV % Test,
        "com.novocode" % "junit-interface" % junitInterfaceV % Test,
        "org.scalatest" %% "scalatest" % "latest.integration" % Test,
        "org.scalameta" %% "munit" % "latest.integration" % Test,
        "org.json" % "json" % "latest.integration",
        "org.scala-lang" %% "toolkit" % "0.7.0",
        "org.antlr" % "antlr4-runtime" % "4.13.2",
        "org.antlr" % "antlr4" % "4.13.2"
      )
    },
    Compile / unmanagedSourceDirectories ++= {
      val managed = (Compile / sourceManaged).value / "antlr4"
      Seq(managed)
    },
    Compile / unmanagedSourceDirectories ++= {
      val managed = (Compile / sourceManaged).value / "antlr4"
      Seq(managed)
    },
    testOptions += Tests.Argument(TestFrameworks.JUnit, "-v")
  )
```

6. Download lexer and grammar files for your choice of programming language (.g4).  Here, I have downloaded for Java: `Java20Lexer.g4` and `Java20Parser.g4`

Create a folder called `src/main/antlr4`.  You may copy the lexer and parser files directly in this folder. But it is recommend to create a package structure of your choice, copy the lexer and parser filer into the package and the then modify the header of lexer and parser files:

```
mkdir -p src/main/src/main/antlr4/org/naderica/parser/sourcecode/ast/java/standard
```

and then add the following "header" line to both the lexer and the parser files:
```
lexer grammar Java20Lexer;

@header {
package org.naderica.parser.sourcecode.ast.java.standard;
}
```

Now, you can run `sbt compile` to generate both source and class files for the lexer and the parser.

7. Now, running the following commands, automatically generates lexer and parser files. Then it will compile the autogenerated files along with the ordinary files. 

```
sbt
antlr4GenerateAll
compile
```

Under the hood, `antlr4GenerateAll` reads all `*.g4` files.  Then runs lexers and parsers, in that order.  Then a number of source files are generated and placed with `target/.../src_managed`.  Note that `antlr4GenerateAll` respects the file hierarchy and generates accordingly in the same file hierarchy.

8. Having followed the steps above, you can import the auto-generated lexer and parser in your code with:

lexer grammar Java20Lexer;

```
import org.naderica.parser.sourcecode.ast.java.standard.*;
```

or more specifically like:

```
import org.naderica.parser.sourcecode.ast.java.standard.Java20Parser;
import org.naderica.parser.sourcecode.ast.java.standard.Java20ParserBaseVisitor;
```


# VSCode

If you are running VSCode, you can create a custom launcher to run your custom parser with `CTRL+F5`.  Example:

Create or modify the file `.vscode/launch.json` with the following content where `mainClass` and `args` are your main  method (`@main def ... `) and the arguments you want to pass to main method. 

```
{
    // Use IntelliSense to learn about possible attributes.
    // Hover to view descriptions of existing attributes.
    // For more information, visit: https://go.microsoft.com/fwlink/?linkid=830387
    "version": "0.2.0",
    "configurations": [
        {
            "type": "scala",
            "request": "launch",
            "name": "JavaParser",
            "mainClass": "org.naderica.parser.sourcecode.java.standard.runJavaParser",
            "args": ["src/main/java/acme/banking"]
        }

    ]
}
```